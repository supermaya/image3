<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê´€ë¦¬ì í˜ì´ì§€</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js';
        import { getAuth, onAuthStateChanged, signOut } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js';
        import { getFirestore, doc, setDoc, getDoc, updateDoc, collection, addDoc, query, orderBy, getDocs, where, deleteDoc, writeBatch } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';
        import { getStorage, ref, uploadBytes, getDownloadURL, deleteObject } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-storage.js';

        // Firebase ì„¤ì •
        const firebaseConfig = {
            apiKey: "AIzaSyAChI2Lr2RgLxIJWg-NCafGhbgo7MHfpLA",
            authDomain: "pixelplanet-95dd9.firebaseapp.com",
            projectId: "pixelplanet-95dd9",
            storageBucket: "pixelplanet-95dd9.firebasestorage.app",
            messagingSenderId: "895107624648",
            appId: "1:895107624648:web:f928b2e9156691fab97ffd",
            measurementId: "G-4JVYXYZPW0"
        };

        // Firebase ì´ˆê¸°í™”
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const storage = getStorage(app);

        // ì „ì—­ìœ¼ë¡œ ë…¸ì¶œ
        window.firebaseAuth = auth;
        window.firebaseDb = db;
        window.firebaseStorage = storage;
        window.firebaseOnAuthStateChanged = onAuthStateChanged;
        window.firebaseSignOut = signOut;
        window.firebaseDoc = doc;
        window.firebaseSetDoc = setDoc;
        window.firebaseGetDoc = getDoc;
        window.firebaseUpdateDoc = updateDoc;
        window.firebaseDeleteDoc = deleteDoc;
        window.firebaseCollection = collection;
        window.firebaseAddDoc = addDoc;
        window.firebaseQuery = query;
        window.firebaseOrderBy = orderBy;
        window.firebaseGetDocs = getDocs;
        window.firebaseWhere = where;
        window.firebaseWriteBatch = writeBatch;
        window.firebaseStorageRef = ref;
        window.firebaseUploadBytes = uploadBytes;
        window.firebaseGetDownloadURL = getDownloadURL;
        window.firebaseDeleteObject = deleteObject;
    </script>
    <style>
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
        }
        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .item {
            transition: all 0.2s;
        }
        .item:hover {
            transform: translateX(5px);
            background-color: #f3f4f6;
        }
        .recommended-badge {
            background-color: #fbbf24;
            color: #78350f;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
        }
        .category-badge {
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
            color: white;
        }
        .tab-button {
            padding: 12px 24px;
            font-weight: 600;
            border-bottom: 3px solid transparent;
            transition: all 0.2s;
            cursor: pointer;
        }
        .tab-button.active {
            border-bottom-color: #3B82F6;
            color: #3B82F6;
        }
        .tab-button:hover {
            background-color: #f3f4f6;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">
    <!-- ì ‘ê·¼ ê¶Œí•œ í™•ì¸ ë©”ì‹œì§€ -->
    <div id="access-denied" class="hidden fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-lg shadow-xl p-8 max-w-md">
            <h2 class="text-2xl font-bold text-red-600 mb-4">ì ‘ê·¼ ê±°ë¶€</h2>
            <p class="text-gray-700 mb-6">ì´ í˜ì´ì§€ëŠ” ê´€ë¦¬ìë§Œ ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
            <button onclick="location.href='index.html'" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-6 rounded-lg transition duration-200">
                ë©”ì¸ìœ¼ë¡œ ëŒì•„ê°€ê¸°
            </button>
        </div>
    </div>

    <div id="admin-content" class="container mx-auto px-4 py-8 max-w-6xl">
        <!-- í—¤ë” -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <h1 class="text-3xl font-bold text-gray-800 mb-2">ê´€ë¦¬ì í˜ì´ì§€</h1>
            <p class="text-gray-600">ì¹´í…Œê³ ë¦¬ì™€ ì¶”ì²œ ê°¤ëŸ¬ë¦¬ë¥¼ ê´€ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
        </div>

        <!-- ë©”ì¸ìœ¼ë¡œ ëŒì•„ê°€ê¸° ë²„íŠ¼ -->
        <div class="mb-6">
            <button onclick="location.href='index.html'" class="bg-gray-600 hover:bg-gray-700 text-white font-semibold py-3 px-6 rounded-lg shadow-md transition duration-200">
                ë©”ì¸ìœ¼ë¡œ ëŒì•„ê°€ê¸°
            </button>
        </div>

        <!-- íƒ­ ë©”ë‰´ -->
        <div class="bg-white rounded-lg shadow-md mb-6">
            <div class="flex border-b">
                <button class="tab-button active" onclick="switchTab('categories')">
                    ì¹´í…Œê³ ë¦¬ ê´€ë¦¬
                </button>
                <button class="tab-button" onclick="switchTab('recommended')">
                    ì¶”ì²œ ê°¤ëŸ¬ë¦¬ ê´€ë¦¬
                </button>
                <button class="tab-button" onclick="switchTab('content')">
                    ì½˜í…ì¸  ê´€ë¦¬
                </button>
                <button class="tab-button" onclick="switchTab('users')">
                    íšŒì› ê´€ë¦¬
                </button>
                <button class="tab-button" onclick="switchTab('hero-slides')">
                    ğŸ¬ íˆì–´ë¡œ ìŠ¬ë¼ì´ë“œ
                </button>
                <button class="tab-button" onclick="switchTab('cleanup')">
                    ğŸ”§ ë°ì´í„° ì •ë¦¬
                </button>
                <button class="tab-button" onclick="switchTab('migration')">
                    ğŸ”„ ë§ˆì´ê·¸ë ˆì´ì…˜
                </button>
            </div>
        </div>

        <!-- ì¹´í…Œê³ ë¦¬ ê´€ë¦¬ íƒ­ -->
        <div id="tab-categories" class="tab-content active">
            <!-- ì¹´í…Œê³ ë¦¬ ì¶”ê°€ ì„¹ì…˜ -->
            <div class="bg-white rounded-lg shadow-md p-6 mb-6">
                <h2 class="text-xl font-semibold text-gray-800 mb-4">âœ¨ ìƒˆ ì¹´í…Œê³ ë¦¬ ì¶”ê°€</h2>
                <div class="flex gap-4 flex-wrap items-end">
                    <div class="flex-1 min-w-[200px]">
                        <label class="block text-gray-700 font-semibold mb-2">ìµœìƒìœ„ ì„¹ì…˜</label>
                        <select id="newCategoryTopSection" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <option value="visual-mode">Looks & Lines</option>
                            <option value="momentary">MOMENTARY</option>
                            <option value="chronicles">CHRONICLES</option>
                        </select>
                    </div>
                    <div class="flex-1 min-w-[200px]">
                        <label class="block text-gray-700 font-semibold mb-2">ì¹´í…Œê³ ë¦¬ëª…</label>
                        <input type="text" id="newCategoryNameInput" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="ì¹´í…Œê³ ë¦¬ëª… ì…ë ¥">
                    </div>
                    <div class="flex-1 min-w-[200px]">
                        <label class="block text-gray-700 font-semibold mb-2">ì¹´í…Œê³ ë¦¬ ë¶„ë¥˜</label>
                        <select id="newCategoryClassification" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <option value="">ë¯¸ë¶„ë¥˜</option>
                            <option value="ì¸ë¬¼">ì¸ë¬¼</option>
                            <option value="íŒ¨ì…˜">íŒ¨ì…˜</option>
                            <option value="í™”ë³´">í™”ë³´</option>
                            <option value="ì‹œë„¤ë§ˆí‹±">ì‹œë„¤ë§ˆí‹±</option>
                        </select>
                    </div>
                    <div>
                        <button onclick="addNewCategory()" class="px-6 py-2 bg-green-600 hover:bg-green-700 text-white font-semibold rounded-lg transition duration-200">
                            ì¶”ê°€
                        </button>
                    </div>
                </div>
            </div>

            <!-- ì¹´í…Œê³ ë¦¬ ëª©ë¡ ì„¹ì…˜ -->
            <div class="bg-white rounded-lg shadow-md p-6">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-semibold text-gray-800">ì¹´í…Œê³ ë¦¬ ëª©ë¡</h2>
                    <div class="flex gap-2">
                        <button onclick="filterCategoriesByTopSection('all')" id="categoryFilter-all" class="px-4 py-2 bg-gray-600 text-white font-semibold rounded-lg transition duration-200">
                            ì „ì²´
                        </button>
                        <button onclick="filterCategoriesByTopSection('visual-mode')" id="categoryFilter-visual-mode" class="px-4 py-2 bg-gray-300 text-gray-700 font-semibold rounded-lg transition duration-200">
                            Looks & Lines
                        </button>
                        <button onclick="filterCategoriesByTopSection('momentary')" id="categoryFilter-momentary" class="px-4 py-2 bg-gray-300 text-gray-700 font-semibold rounded-lg transition duration-200">
                            MOMENTARY
                        </button>
                        <button onclick="filterCategoriesByTopSection('chronicles')" id="categoryFilter-chronicles" class="px-4 py-2 bg-gray-300 text-gray-700 font-semibold rounded-lg transition duration-200">
                            CHRONICLES
                        </button>
                    </div>
                </div>
                <div id="categoryList" class="space-y-3">
                    <!-- ì¹´í…Œê³ ë¦¬ ì•„ì´í…œë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
                </div>
                <div id="emptyCategoryMessage" class="text-center text-gray-500 py-8 hidden">
                    ë“±ë¡ëœ ì¹´í…Œê³ ë¦¬ê°€ ì—†ìŠµë‹ˆë‹¤.
                </div>
            </div>
        </div>

        <!-- ì¶”ì²œ ê°¤ëŸ¬ë¦¬ ê´€ë¦¬ íƒ­ -->
        <div id="tab-recommended" class="tab-content">
            <!-- í•„í„° -->
            <div class="bg-white rounded-lg shadow-md p-6 mb-6">
                <h2 class="text-xl font-semibold text-gray-800 mb-4">í•„í„°</h2>
                <div class="flex gap-4 flex-wrap">
                    <div>
                        <label class="block text-gray-700 font-semibold mb-2">ìµœìƒìœ„ ì„¹ì…˜</label>
                        <select id="filterTopSection" onchange="applyFilter()" class="px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <option value="">ì „ì²´</option>
                            <option value="visual-mode">Looks & Lines</option>
                            <option value="momentary">MOMENTARY</option>
                            <option value="chronicles">CHRONICLES</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-gray-700 font-semibold mb-2">ì¹´í…Œê³ ë¦¬</label>
                        <select id="filterCategory" onchange="applyFilter()" class="px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <option value="">ì „ì²´</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-gray-700 font-semibold mb-2">ì¶”ì²œ ìƒíƒœ</label>
                        <select id="filterRecommended" onchange="applyFilter()" class="px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <option value="">ì „ì²´</option>
                            <option value="1">ì¶”ì²œë¨</option>
                            <option value="0">ë¯¸ì¶”ì²œ</option>
                        </select>
                    </div>
                    <div class="flex items-end">
                        <button onclick="resetFilter()" class="px-4 py-2 bg-gray-300 hover:bg-gray-400 text-gray-800 font-semibold rounded-lg transition duration-200">
                            í•„í„° ì´ˆê¸°í™”
                        </button>
                    </div>
                </div>
            </div>

            <!-- ìŒì•… ëª©ë¡ -->
            <div class="bg-white rounded-lg shadow-md p-6">
                <h2 class="text-xl font-semibold text-gray-800 mb-4">ìŒì•… ëª©ë¡</h2>
                <div id="musicList" class="space-y-3">
                    <!-- ìŒì•… ì•„ì´í…œë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
                </div>
                <div id="emptyMusicMessage" class="text-center text-gray-500 py-8 hidden">
                    ë“±ë¡ëœ ìŒì•…ì´ ì—†ìŠµë‹ˆë‹¤.
                </div>
            </div>
        </div>

        <!-- ì½˜í…ì¸  ê´€ë¦¬ íƒ­ -->
        <div id="tab-content" class="tab-content">
            <!-- í•„í„° ë° ê²€ìƒ‰ -->
            <div class="bg-white rounded-lg shadow-md p-6 mb-6">
                <h2 class="text-xl font-semibold text-gray-800 mb-4">ğŸ” ê²€ìƒ‰ ë° í•„í„°</h2>
                <div class="flex gap-4 flex-wrap">
                    <div class="flex-1 min-w-[200px]">
                        <input type="text" id="searchContentKeyword" placeholder="ì œëª©ìœ¼ë¡œ ê²€ìƒ‰..."
                               class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div>
                        <select id="filterContentTopSection" onchange="applyContentFilter()" class="px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <option value="">ì „ì²´ ì„¹ì…˜</option>
                            <option value="visual-mode">Looks & Lines</option>
                            <option value="momentary">MOMENTARY</option>
                            <option value="chronicles">CHRONICLES</option>
                        </select>
                    </div>
                    <div>
                        <select id="filterContentCategory" onchange="applyContentFilter()" class="px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <option value="">ì „ì²´ ì¹´í…Œê³ ë¦¬</option>
                        </select>
                    </div>
                    <div>
                        <button onclick="applyContentFilter()" class="px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-lg transition duration-200">
                            ê²€ìƒ‰
                        </button>
                    </div>
                    <div>
                        <button onclick="resetContentFilter()" class="px-6 py-2 bg-gray-600 hover:bg-gray-700 text-white font-semibold rounded-lg transition duration-200">
                            ì´ˆê¸°í™”
                        </button>
                    </div>
                </div>
            </div>

            <!-- ì½˜í…ì¸  ëª©ë¡ -->
            <div class="bg-white rounded-lg shadow-md p-6">
                <h2 class="text-xl font-semibold text-gray-800 mb-4">ğŸ“‹ ì½˜í…ì¸  ëª©ë¡</h2>
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead>
                            <tr class="bg-gray-100 border-b">
                                <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">ì¸ë„¤ì¼</th>
                                <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">ì œëª©</th>
                                <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">ì¹´í…Œê³ ë¦¬</th>
                                <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">ì¶”ì²œ</th>
                                <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">ì—…ë¡œë“œì¼</th>
                                <th class="px-4 py-3 text-center text-sm font-semibold text-gray-700">ì‘ì—…</th>
                            </tr>
                        </thead>
                        <tbody id="contentList">
                            <!-- ì½˜í…ì¸  ëª©ë¡ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
                        </tbody>
                    </table>
                </div>
                <div id="emptyContentMessage" class="text-center text-gray-500 py-8 hidden">
                    ì½˜í…ì¸ ê°€ ì—†ìŠµë‹ˆë‹¤.
                </div>
            </div>
        </div>

        <!-- ë°ì´í„° ì •ë¦¬ íƒ­ -->
        <div id="tab-cleanup" class="tab-content">
            <!-- í˜„ì¬ ìƒíƒœ -->
            <div class="bg-white rounded-lg shadow-md p-6 mb-6">
                <h2 class="text-xl font-semibold text-gray-800 mb-4">ğŸ“Š í˜„ì¬ ë°ì´í„°ë² ì´ìŠ¤ ìƒíƒœ</h2>
                <div class="space-y-3">
                    <button onclick="checkDatabaseStatus()" class="px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-lg transition duration-200">
                        ë°ì´í„°ë² ì´ìŠ¤ ìƒíƒœ í™•ì¸
                    </button>
                    <div id="dbStatus" class="mt-4 p-4 bg-gray-50 rounded-lg hidden">
                        <pre id="dbStatusContent" class="text-sm text-gray-700 whitespace-pre-wrap"></pre>
                    </div>
                </div>
            </div>

            <!-- ì¹´í…Œê³ ë¦¬ ì •ë¦¬ -->
            <div class="bg-white rounded-lg shadow-md p-6 mb-6">
                <h2 class="text-xl font-semibold text-gray-800 mb-4">ğŸ—‚ï¸ ì¹´í…Œê³ ë¦¬ ì •ë¦¬</h2>
                <p class="text-gray-600 mb-4">ì‚¬ìš©ë˜ì§€ ì•ŠëŠ” ì¹´í…Œê³ ë¦¬ë¥¼ ì‚­ì œí•˜ê±°ë‚˜, ìŒì•…ì˜ ì¹´í…Œê³ ë¦¬ë¥¼ ì¼ê´„ ë³€ê²½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

                <div class="space-y-4">
                    <div>
                        <label class="block text-gray-700 font-semibold mb-2">ê¸°ì¡´ ì¹´í…Œê³ ë¦¬</label>
                        <input type="text" id="oldCategoryBulk" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="ë³€ê²½í•  ì¹´í…Œê³ ë¦¬ëª…">
                    </div>
                    <div>
                        <label class="block text-gray-700 font-semibold mb-2">ìƒˆ ì¹´í…Œê³ ë¦¬</label>
                        <input type="text" id="newCategoryBulk" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="ìƒˆë¡œìš´ ì¹´í…Œê³ ë¦¬ëª…">
                    </div>
                    <button onclick="bulkUpdateCategory()" class="px-6 py-3 bg-green-600 hover:bg-green-700 text-white font-semibold rounded-lg transition duration-200">
                        ì¹´í…Œê³ ë¦¬ ì¼ê´„ ë³€ê²½
                    </button>
                </div>
            </div>

            <!-- ë¹ˆ ì¹´í…Œê³ ë¦¬ ì •ë¦¬ -->
            <div class="bg-white rounded-lg shadow-md p-6 mb-6">
                <h2 class="text-xl font-semibold text-gray-800 mb-4">ğŸ§¹ ì‚¬ìš©ë˜ì§€ ì•ŠëŠ” ì¹´í…Œê³ ë¦¬ ì •ë¦¬</h2>
                <p class="text-gray-600 mb-4">ìŒì•…ì—ì„œ ì‚¬ìš©ë˜ì§€ ì•ŠëŠ” ì¹´í…Œê³ ë¦¬ë¥¼ ìë™ìœ¼ë¡œ ì‚­ì œí•©ë‹ˆë‹¤.</p>
                <button onclick="cleanupUnusedCategories()" class="px-6 py-3 bg-orange-600 hover:bg-orange-700 text-white font-semibold rounded-lg transition duration-200">
                    ì‚¬ìš©ë˜ì§€ ì•ŠëŠ” ì¹´í…Œê³ ë¦¬ ì •ë¦¬
                </button>
            </div>
        </div>

        <!-- íšŒì› ê´€ë¦¬ íƒ­ -->
        <div id="tab-users" class="tab-content">
            <!-- ê²€ìƒ‰ -->
            <div class="bg-white rounded-lg shadow-md p-6 mb-6">
                <h2 class="text-xl font-semibold text-gray-800 mb-4">íšŒì› ê²€ìƒ‰</h2>
                <div class="flex gap-4 flex-wrap">
                    <div class="flex-1 min-w-[200px]">
                        <input type="text" id="searchUserEmail" placeholder="ì´ë©”ì¼ë¡œ ê²€ìƒ‰..."
                               class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div>
                        <button onclick="searchUsers()" class="px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-lg transition duration-200">
                            ê²€ìƒ‰
                        </button>
                    </div>
                    <div>
                        <button onclick="loadAllUsers()" class="px-6 py-2 bg-gray-600 hover:bg-gray-700 text-white font-semibold rounded-lg transition duration-200">
                            ì „ì²´ íšŒì› ë³´ê¸°
                        </button>
                    </div>
                </div>
            </div>

            <!-- íšŒì› ëª©ë¡ -->
            <div class="bg-white rounded-lg shadow-md p-6">
                <h2 class="text-xl font-semibold text-gray-800 mb-4">íšŒì› ëª©ë¡</h2>
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead>
                            <tr class="bg-gray-100 border-b">
                                <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">ì´ë©”ì¼</th>
                                <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">ì—­í• </th>
                                <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">ì¼ì¼ í¬ì¸íŠ¸</th>
                                <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">ì§€ê°‘ í¬ì¸íŠ¸</th>
                                <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">ê°€ì…ì¼</th>
                                <th class="px-4 py-3 text-center text-sm font-semibold text-gray-700">ì‘ì—…</th>
                            </tr>
                        </thead>
                        <tbody id="userList">
                            <!-- íšŒì› ëª©ë¡ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
                        </tbody>
                    </table>
                </div>
                <div id="emptyUserMessage" class="text-center text-gray-500 py-8 hidden">
                    íšŒì› ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.
                </div>
            </div>

        </div>

        <!-- íˆì–´ë¡œ ìŠ¬ë¼ì´ë“œ ê´€ë¦¬ íƒ­ -->
        <div id="tab-hero-slides" class="tab-content">
            <!-- ìŠ¬ë¼ì´ë“œ ì¶”ê°€ ì„¹ì…˜ -->
            <div class="bg-white rounded-lg shadow-md p-6 mb-6">
                <h2 class="text-xl font-semibold text-gray-800 mb-4">ğŸ¬ ìƒˆ ìŠ¬ë¼ì´ë“œ ì¶”ê°€</h2>
                <div class="space-y-4">
                    <div>
                        <label class="block text-gray-700 font-semibold mb-2">ì œëª©</label>
                        <input type="text" id="newSlideTitle" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="ìŠ¬ë¼ì´ë“œ ì œëª© ì…ë ¥">
                    </div>
                    <div>
                        <label class="block text-gray-700 font-semibold mb-2">ë¶€ì œëª©</label>
                        <input type="text" id="newSlideSubtitle" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="ìŠ¬ë¼ì´ë“œ ë¶€ì œëª© ì…ë ¥">
                    </div>
                    <div>
                        <label class="block text-gray-700 font-semibold mb-2">ì´ë¯¸ì§€</label>
                        <input type="file" id="newSlideImage" accept="image/*" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <p class="text-sm text-gray-500 mt-1">ê¶Œì¥ í¬ê¸°: 1920x1080px</p>
                    </div>
                    <div>
                        <label class="block text-gray-700 font-semibold mb-2">ë§í¬ (ì„ íƒì‚¬í•­)</label>
                        <input type="text" id="newSlideLink" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="í´ë¦­ì‹œ ì´ë™í•  URL ì…ë ¥">
                    </div>
                    <div>
                        <label class="block text-gray-700 font-semibold mb-2">í‘œì‹œ ìˆœì„œ</label>
                        <input type="number" id="newSlideOrder" min="0" value="0" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div class="flex items-center">
                        <label class="flex items-center cursor-pointer">
                            <input type="checkbox" id="newSlideActive" checked class="w-5 h-5 text-blue-600 border-gray-300 rounded focus:ring-blue-500">
                            <span class="ml-2 text-gray-700 font-semibold">í™œì„±í™”</span>
                        </label>
                    </div>
                    <div>
                        <button onclick="addNewSlide()" class="w-full px-6 py-3 bg-green-600 hover:bg-green-700 text-white font-semibold rounded-lg transition duration-200">
                            ìŠ¬ë¼ì´ë“œ ì¶”ê°€
                        </button>
                    </div>
                </div>
            </div>

            <!-- ìŠ¬ë¼ì´ë“œ ëª©ë¡ ì„¹ì…˜ -->
            <div class="bg-white rounded-lg shadow-md p-6">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-semibold text-gray-800">ìŠ¬ë¼ì´ë“œ ëª©ë¡</h2>
                    <button onclick="loadHeroSlides()" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-lg transition duration-200">
                        ìƒˆë¡œê³ ì¹¨
                    </button>
                </div>
                <div id="heroSlidesList" class="space-y-4">
                    <!-- ìŠ¬ë¼ì´ë“œ ì•„ì´í…œë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
                </div>
                <div id="emptyHeroSlidesMessage" class="text-center text-gray-500 py-8 hidden">
                    ë“±ë¡ëœ ìŠ¬ë¼ì´ë“œê°€ ì—†ìŠµë‹ˆë‹¤.
                </div>
            </div>
        </div>

        <!-- ë§ˆì´ê·¸ë ˆì´ì…˜ íƒ­ -->
        <div id="tab-migration" class="tab-content">
            <div class="bg-white rounded-lg shadow-md p-6 mb-6">
                <h2 class="text-xl font-semibold text-gray-800 mb-4">ğŸ”„ ì¹´í…Œê³ ë¦¬ ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜</h2>

                <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-6">
                    <h3 class="font-semibold text-yellow-800 mb-2">âš ï¸ ì£¼ì˜ì‚¬í•­</h3>
                    <ul class="text-sm text-yellow-700 space-y-1">
                        <li>â€¢ ì´ ê¸°ëŠ¥ì€ ëª¨ë“  ê¸°ì¡´ ì¹´í…Œê³ ë¦¬ì— topSection='visual-mode'ë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤.</li>
                        <li>â€¢ ì´ë¯¸ topSectionì´ ìˆëŠ” ì¹´í…Œê³ ë¦¬ëŠ” ê±´ë„ˆëœë‹ˆë‹¤.</li>
                        <li>â€¢ ì‹¤í–‰ ì „ 'ìƒíƒœ í™•ì¸'ì„ ë¨¼ì € ëˆŒëŸ¬ í˜„ì¬ ìƒíƒœë¥¼ í™•ì¸í•˜ì„¸ìš”.</li>
                        <li>â€¢ ë§ˆì´ê·¸ë ˆì´ì…˜ í›„ ê° ì¹´í…Œê³ ë¦¬ì˜ topSectionì„ ì ì ˆíˆ ìˆ˜ì •í•˜ì„¸ìš”.</li>
                    </ul>
                </div>

                <div class="flex gap-4 mb-6">
                    <button onclick="checkMigrationStatus()" id="checkMigrationBtn" class="px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-lg transition duration-200">
                        1ï¸âƒ£ ìƒíƒœ í™•ì¸
                    </button>
                    <button onclick="runCategoryMigration()" id="migrationBtn" disabled class="px-6 py-3 bg-green-600 hover:bg-green-700 text-white font-semibold rounded-lg transition duration-200 disabled:bg-gray-400 disabled:cursor-not-allowed">
                        2ï¸âƒ£ ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤í–‰
                    </button>
                </div>

                <div class="bg-gray-50 border border-gray-200 rounded-lg p-4">
                    <h3 class="font-semibold text-gray-800 mb-2">ğŸ“Š ì‹¤í–‰ ë¡œê·¸</h3>
                    <div id="migrationLog" class="font-mono text-xs text-gray-700 max-h-96 overflow-y-auto whitespace-pre-wrap">
                        ë¡œê·¸ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤...
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ì½˜í…ì¸  í¸ì§‘ ëª¨ë‹¬ -->
    <div id="editContentModal" class="modal">
        <div class="bg-white rounded-lg shadow-xl p-8 max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto">
            <h2 class="text-2xl font-bold text-gray-800 mb-4">ì½˜í…ì¸  í¸ì§‘</h2>
            <input type="hidden" id="editContentId">

            <!-- ì¸ë„¤ì¼ ë¯¸ë¦¬ë³´ê¸° -->
            <div class="mb-4">
                <label class="block text-gray-700 font-semibold mb-2">ì¸ë„¤ì¼</label>
                <img id="editContentThumbnail" src="" alt="ì¸ë„¤ì¼" class="w-32 h-32 object-cover rounded-lg border">
            </div>

            <div class="mb-4">
                <label class="block text-gray-700 font-semibold mb-2">ì œëª©</label>
                <input type="text" id="editContentName" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="ì œëª© ì…ë ¥">
            </div>

            <div class="mb-4">
                <label class="block text-gray-700 font-semibold mb-2">ì¹´í…Œê³ ë¦¬</label>
                <select id="editContentCategory" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <option value="">ì¹´í…Œê³ ë¦¬ ì—†ìŒ</option>
                </select>
            </div>

            <div class="mb-4">
                <label class="block text-gray-700 font-semibold mb-2">
                    <input type="checkbox" id="editContentRecommended" class="mr-2">
                    ì¶”ì²œ ì½˜í…ì¸ ë¡œ í‘œì‹œ
                </label>
            </div>

            <div class="mb-4">
                <label class="block text-gray-700 font-semibold mb-2">ìŒì•… URL</label>
                <input type="text" id="editContentMusicUrl" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="ìŒì•… URL">
            </div>

            <div class="mb-4">
                <label class="block text-gray-700 font-semibold mb-2">ì´ë¯¸ì§€ ê°œìˆ˜</label>
                <input type="number" id="editContentImageCount" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="ì´ë¯¸ì§€ ê°œìˆ˜" readonly>
            </div>

            <div class="flex justify-end space-x-3">
                <button onclick="closeEditContentModal()" class="px-6 py-2 bg-gray-300 hover:bg-gray-400 text-gray-800 font-semibold rounded-lg transition duration-200">
                    ì·¨ì†Œ
                </button>
                <button onclick="saveContentEdit()" class="px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-lg transition duration-200">
                    ì €ì¥
                </button>
            </div>
        </div>
    </div>

    <!-- ì¹´í…Œê³ ë¦¬ í¸ì§‘ ëª¨ë‹¬ -->
    <div id="editModal" class="modal">
        <div class="bg-white rounded-lg shadow-xl p-8 max-w-md w-full mx-4">
            <h2 class="text-2xl font-bold text-gray-800 mb-4">ì¹´í…Œê³ ë¦¬ í¸ì§‘</h2>
            <input type="hidden" id="oldCategoryName">
            <input type="hidden" id="oldCategoryId">
            <div class="mb-4">
                <label class="block text-gray-700 font-semibold mb-2">ìµœìƒìœ„ ì„¹ì…˜</label>
                <select id="editCategoryTopSection" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <option value="visual-mode">Looks & Lines</option>
                    <option value="momentary">MOMENTARY</option>
                    <option value="chronicles">CHRONICLES</option>
                </select>
            </div>
            <div class="mb-4">
                <label class="block text-gray-700 font-semibold mb-2">ì¹´í…Œê³ ë¦¬ëª…</label>
                <input type="text" id="newCategoryName" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="ì¹´í…Œê³ ë¦¬ëª… ì…ë ¥">
            </div>
            <div class="mb-4">
                <label class="block text-gray-700 font-semibold mb-2">ì¹´í…Œê³ ë¦¬ ë¶„ë¥˜</label>
                <select id="editCategoryClassification" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <option value="">ë¯¸ë¶„ë¥˜</option>
                    <option value="ì¸ë¬¼">ì¸ë¬¼</option>
                    <option value="íŒ¨ì…˜">íŒ¨ì…˜</option>
                    <option value="í™”ë³´">í™”ë³´</option>
                    <option value="ì‹œë„¤ë§ˆí‹±">ì‹œë„¤ë§ˆí‹±</option>
                </select>
            </div>
            <div class="flex justify-end space-x-3">
                <button onclick="closeEditModal()" class="px-6 py-2 bg-gray-300 hover:bg-gray-400 text-gray-800 font-semibold rounded-lg transition duration-200">
                    ì·¨ì†Œ
                </button>
                <button onclick="updateCategory()" class="px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-lg transition duration-200">
                    ì €ì¥
                </button>
            </div>
        </div>
    </div>

    <script>
        let currentTab = 'categories';
        let allMusicData = [];
        let filteredMusicData = [];
        let allCategories = [];
        let categoryDetailsMap = {};

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ê´€ë¦¬ì ê¶Œí•œ í™•ì¸ ë° ë°ì´í„° ë¡œë“œ
        document.addEventListener('DOMContentLoaded', async function() {
            const hasAccess = await checkAdminAccess();
            if (hasAccess) {
                loadCategories();
                loadMusicList();
                loadContentList();
            }
        });

        // ê´€ë¦¬ì ê¶Œí•œ í™•ì¸
        async function checkAdminAccess() {
            return new Promise((resolve) => {
                window.firebaseOnAuthStateChanged(window.firebaseAuth, async (user) => {
                    try {
                        if (!user) {
                            console.log('No user logged in');
                            document.getElementById('access-denied').classList.remove('hidden');
                            document.getElementById('admin-content').style.display = 'none';
                            resolve(false);
                            return;
                        }

                        // Firestoreì—ì„œ ì‚¬ìš©ì ì •ë³´ ê°€ì ¸ì˜¤ê¸°
                        const userDocRef = window.firebaseDoc(window.firebaseDb, 'users', user.uid);
                        const userDoc = await window.firebaseGetDoc(userDocRef);

                        if (!userDoc.exists()) {
                            console.log('User document does not exist');
                            document.getElementById('access-denied').classList.remove('hidden');
                            document.getElementById('admin-content').style.display = 'none';
                            resolve(false);
                            return;
                        }

                        const userData = userDoc.data();
                        console.log('User data:', userData);

                        if (userData.role !== 'admin') {
                            console.log('User is not admin, role:', userData.role);
                            document.getElementById('access-denied').classList.remove('hidden');
                            document.getElementById('admin-content').style.display = 'none';
                            resolve(false);
                            return;
                        }

                        console.log('Admin access granted');
                        resolve(true);
                    } catch (error) {
                        console.error('Error checking admin access:', error);
                        document.getElementById('access-denied').classList.remove('hidden');
                        document.getElementById('admin-content').style.display = 'none';
                        resolve(false);
                    }
                });
            });
        }

        // íƒ­ ì „í™˜
        function switchTab(tabName) {
            currentTab = tabName;

            // íƒ­ ë²„íŠ¼ í™œì„±í™” ìƒíƒœ ë³€ê²½
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');

            // íƒ­ ì»¨í…ì¸  í‘œì‹œ/ìˆ¨ê¹€
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(`tab-${tabName}`).classList.add('active');

            // íˆì–´ë¡œ ìŠ¬ë¼ì´ë“œ íƒ­ í™œì„±í™”ì‹œ ëª©ë¡ ë¡œë“œ
            if (tabName === 'hero-slides') {
                loadHeroSlides();
            }
        }

        // ========== ì¹´í…Œê³ ë¦¬ ê´€ë¦¬ í•¨ìˆ˜ë“¤ ==========

        // ìƒˆ ì¹´í…Œê³ ë¦¬ ì¶”ê°€
        async function addNewCategory() {
            const topSection = document.getElementById('newCategoryTopSection').value.trim();
            const categoryName = document.getElementById('newCategoryNameInput').value.trim();
            const classification = document.getElementById('newCategoryClassification').value.trim();

            if (!categoryName) {
                alert('ì¹´í…Œê³ ë¦¬ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            // ì¤‘ë³µ í™•ì¸
            if (allCategories.includes(categoryName)) {
                alert('ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ì¹´í…Œê³ ë¦¬ì…ë‹ˆë‹¤.');
                return;
            }

            try {
                // Firestoreì— ì¹´í…Œê³ ë¦¬ ì¶”ê°€
                const categoryRef = window.firebaseDoc(window.firebaseDb, 'categories', categoryName);
                await window.firebaseSetDoc(categoryRef, {
                    name: categoryName,
                    topSection: topSection || 'visual-mode',
                    classification: classification || 'ê¸°íƒ€',
                    description: '',
                    createdAt: new Date().toISOString(),
                    createdBy: window.firebaseAuth.currentUser?.uid || 'admin'
                });

                alert(`"${categoryName}" ì¹´í…Œê³ ë¦¬ê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.`);

                // ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
                document.getElementById('newCategoryTopSection').value = 'visual-mode';
                document.getElementById('newCategoryNameInput').value = '';
                document.getElementById('newCategoryClassification').value = '';

                // ì¶”ê°€ëœ ì¹´í…Œê³ ë¦¬ì˜ ì„¹ì…˜ìœ¼ë¡œ í•„í„° ì„¤ì •
                currentCategoryFilter = topSection;

                // ì¹´í…Œê³ ë¦¬ ëª©ë¡ ìƒˆë¡œê³ ì¹¨ (ìë™ìœ¼ë¡œ currentCategoryFilter ì ìš©ë¨)
                await loadCategories();
                renderCategoryFilter();
                renderContentCategoryFilter();
                notifyMainPage('categoryUpdated');
            } catch (error) {
                console.error('Error adding category:', error);
                alert('ì¹´í…Œê³ ë¦¬ ì¶”ê°€ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
            }
        }

        // ì¹´í…Œê³ ë¦¬ ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸°
        let allCategoryDetailsData = []; // ì „ì—­ ë³€ìˆ˜ë¡œ ì¹´í…Œê³ ë¦¬ ìƒì„¸ ì •ë³´ ì €ì¥
        let currentCategoryFilter = 'all'; // í˜„ì¬ ì„ íƒëœ topSection í•„í„°

        async function loadCategories() {
            try {
                // Firestoreì—ì„œ categories ì»¬ë ‰ì…˜ ì¡°íšŒ
                const categoriesCollection = window.firebaseCollection(window.firebaseDb, 'categories');
                const querySnapshot = await window.firebaseGetDocs(categoriesCollection);

                const categoryDetails = [];
                querySnapshot.forEach(doc => {
                    const data = doc.data();
                    categoryDetails.push({
                        id: doc.id,
                        name: data.name || doc.id,  // data.name ìš°ì„ , ì—†ìœ¼ë©´ doc.id ì‚¬ìš©
                        topSection: data.topSection || 'visual-mode',
                        classification: data.classification || 'ê¸°íƒ€',
                        description: data.description || ''
                    });
                });

                allCategories = categoryDetails.map(cat => cat.name);
                allCategoryDetailsData = categoryDetails; // ì „ì—­ ë³€ìˆ˜ì— ì €ì¥
                filterCategoriesByTopSection(currentCategoryFilter); // í˜„ì¬ í•„í„°ë¡œ ë Œë”ë§
                renderCategoryFilter();
            } catch (error) {
                console.error('Error loading categories:', error);
                alert('ì¹´í…Œê³ ë¦¬ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
            }
        }

        // topSectionë³„ë¡œ ì¹´í…Œê³ ë¦¬ í•„í„°ë§
        function filterCategoriesByTopSection(topSection) {
            currentCategoryFilter = topSection;

            // ë²„íŠ¼ ìŠ¤íƒ€ì¼ ì—…ë°ì´íŠ¸
            document.querySelectorAll('[id^="categoryFilter-"]').forEach(btn => {
                btn.classList.remove('bg-gray-600', 'text-white');
                btn.classList.add('bg-gray-300', 'text-gray-700');
            });
            const activeBtn = document.getElementById(`categoryFilter-${topSection}`);
            if (activeBtn) {
                activeBtn.classList.remove('bg-gray-300', 'text-gray-700');
                activeBtn.classList.add('bg-gray-600', 'text-white');
            }

            // ì¹´í…Œê³ ë¦¬ í•„í„°ë§
            let filteredCategories = allCategoryDetailsData;
            if (topSection !== 'all') {
                filteredCategories = allCategoryDetailsData.filter(cat => cat.topSection === topSection);
            }

            renderCategories(filteredCategories);
        }

        // ë¶„ë¥˜ë³„ ìƒ‰ìƒ ë§¤í•‘
        function getClassificationColor(classification) {
            const colors = {
                'ì¸ë¬¼': {
                    bg: 'bg-blue-100',
                    border: 'border-blue-400',
                    text: 'text-blue-800',
                    badge: 'bg-blue-500',
                    editBtn: 'bg-blue-500 hover:bg-blue-600',
                    deleteBtn: 'bg-blue-700 hover:bg-blue-800',
                    hex: '#3B82F6'
                },
                'íŒ¨ì…˜': {
                    bg: 'bg-pink-100',
                    border: 'border-pink-400',
                    text: 'text-pink-800',
                    badge: 'bg-pink-500',
                    editBtn: 'bg-pink-500 hover:bg-pink-600',
                    deleteBtn: 'bg-pink-700 hover:bg-pink-800',
                    hex: '#EC4899'
                },
                'í™”ë³´': {
                    bg: 'bg-green-100',
                    border: 'border-green-400',
                    text: 'text-green-800',
                    badge: 'bg-green-500',
                    editBtn: 'bg-green-500 hover:bg-green-600',
                    deleteBtn: 'bg-green-700 hover:bg-green-800',
                    hex: '#10B981'
                },
                'ì‹œë„¤ë§ˆí‹±': {
                    bg: 'bg-purple-100',
                    border: 'border-purple-400',
                    text: 'text-purple-800',
                    badge: 'bg-purple-500',
                    editBtn: 'bg-purple-500 hover:bg-purple-600',
                    deleteBtn: 'bg-purple-700 hover:bg-purple-800',
                    hex: '#8B5CF6'
                }
            };
            return colors[classification] || {
                bg: 'bg-gray-100',
                border: 'border-gray-400',
                text: 'text-gray-800',
                badge: 'bg-gray-500',
                editBtn: 'bg-gray-500 hover:bg-gray-600',
                deleteBtn: 'bg-gray-700 hover:bg-gray-800',
                hex: '#6B7280'
            };
        }

        // ì¹´í…Œê³ ë¦¬ ëª©ë¡ ë Œë”ë§
        function renderCategories(categoryDetails) {
            const categoryList = document.getElementById('categoryList');
            const emptyMessage = document.getElementById('emptyCategoryMessage');

            if (!categoryDetails || categoryDetails.length === 0) {
                categoryList.innerHTML = '';
                emptyMessage.classList.remove('hidden');
            } else {
                emptyMessage.classList.add('hidden');

                categoryDetailsMap = {};
                categoryDetails.forEach(cat => {
                    categoryDetailsMap[cat.name] = {
                        topSection: cat.topSection || 'visual-mode',
                        classification: cat.classification,
                        id: cat.id
                    };
                });

                categoryList.innerHTML = categoryDetails.map(category => {
                    const colors = getClassificationColor(category.classification);
                    const classificationLabel = category.classification || 'ë¯¸ë¶„ë¥˜';

                    // topSection ì´ë¦„ ë§¤í•‘
                    const topSectionNames = {
                        'visual-mode': 'Looks & Lines',
                        'momentary': 'MOMENTARY',
                        'chronicles': 'CHRONICLES'
                    };
                    const topSectionLabel = topSectionNames[category.topSection] || 'Looks & Lines';
                    const topSectionBadge = `<span class="px-2 py-1 bg-gray-700 text-white text-xs font-bold rounded ml-2">${topSectionLabel}</span>`;

                    return `
                        <div class="item flex items-center justify-between p-4 border-2 ${colors.border} ${colors.bg} rounded-lg">
                            <div class="flex items-center space-x-3">
                                <span class="text-lg font-medium ${colors.text}">${escapeHtml(category.name)}</span>
                                ${topSectionBadge}
                            </div>
                            <div class="space-x-2">
                                <button onclick="openEditModal('${escapeHtml(category.id)}', '${escapeHtml(category.name)}', '${escapeHtml(category.topSection || 'visual-mode')}', '${escapeHtml(category.classification || '')}')" class="px-4 py-2 ${colors.editBtn} text-white font-semibold rounded transition duration-200">
                                    í¸ì§‘
                                </button>
                                <button onclick="deleteCategory('${escapeHtml(category.name)}')" class="px-4 py-2 ${colors.deleteBtn} text-white font-semibold rounded transition duration-200">
                                    ì‚­ì œ
                                </button>
                            </div>
                        </div>
                    `;
                }).join('');
            }
        }

        // í¸ì§‘ ëª¨ë‹¬ ì—´ê¸°
        function openEditModal(categoryId, categoryName, topSection, classification) {
            document.getElementById('oldCategoryId').value = categoryId;
            document.getElementById('oldCategoryName').value = categoryName;
            document.getElementById('newCategoryName').value = categoryName;
            document.getElementById('editCategoryTopSection').value = topSection || 'visual-mode';
            document.getElementById('editCategoryClassification').value = classification || '';

            document.getElementById('editModal').classList.add('active');
        }

        // ìˆ˜ì • ëª¨ë‹¬ ë‹«ê¸°
        function closeEditModal() {
            document.getElementById('editModal').classList.remove('active');
        }

        // ì¹´í…Œê³ ë¦¬ ì—…ë°ì´íŠ¸ (ì´ë¦„ ë° ë¶„ë¥˜ ë³€ê²½)
        async function updateCategory() {
            const categoryId = document.getElementById('oldCategoryId').value.trim();
            const oldCategoryName = document.getElementById('oldCategoryName').value.trim();
            const newCategoryName = document.getElementById('newCategoryName').value.trim();
            const newTopSection = document.getElementById('editCategoryTopSection').value.trim();
            const newClassification = document.getElementById('editCategoryClassification').value.trim();

            if (!newCategoryName) {
                alert('ì¹´í…Œê³ ë¦¬ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            try {
                // ì¹´í…Œê³ ë¦¬ëª…ì´ ë³€ê²½ëœ ê²½ìš°
                if (oldCategoryName !== newCategoryName) {
                    // í•´ë‹¹ ì¹´í…Œê³ ë¦¬ë¥¼ ì‚¬ìš©í•˜ëŠ” ëª¨ë“  ìŒì•… ì°¾ê¸°
                    const musicCollection = window.firebaseCollection(window.firebaseDb, 'music');
                    const musicQuery = window.firebaseQuery(musicCollection, window.firebaseWhere('category', '==', oldCategoryName));
                    const musicSnapshot = await window.firebaseGetDocs(musicQuery);

                    // ìŒì•… ë¬¸ì„œë¥¼ 500ê°œì”© ë‚˜ëˆ ì„œ batch ì²˜ë¦¬ (Firestore batch ì œí•œ)
                    const docs = [];
                    musicSnapshot.forEach(doc => docs.push(doc));

                    for (let i = 0; i < docs.length; i += 500) {
                        const batch = window.firebaseWriteBatch(window.firebaseDb);
                        const chunk = docs.slice(i, i + 500);

                        chunk.forEach(doc => {
                            batch.update(doc.ref, { category: newCategoryName });
                        });

                        await batch.commit();
                    }

                    // ê¸°ì¡´ ì¹´í…Œê³ ë¦¬ ì‚­ì œ
                    const oldCategoryRef = window.firebaseDoc(window.firebaseDb, 'categories', categoryId);
                    await window.firebaseDeleteDoc(oldCategoryRef);
                }

                // ìƒˆ ì¹´í…Œê³ ë¦¬ ì •ë³´ ì €ì¥ (ë¬¸ì„œ ID ì‚¬ìš©)
                const newCategoryRef = window.firebaseDoc(window.firebaseDb, 'categories', categoryId);
                await window.firebaseSetDoc(newCategoryRef, {
                    name: newCategoryName,
                    topSection: newTopSection || 'visual-mode',
                    classification: newClassification || 'ê¸°íƒ€',
                    updatedAt: new Date().toISOString()
                }, { merge: true });

                alert('ì¹´í…Œê³ ë¦¬ê°€ ì„±ê³µì ìœ¼ë¡œ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.');
                closeEditModal();
                loadCategories();
                loadMusicList();
                notifyMainPage('categoryUpdated');
            } catch (error) {
                console.error('Error updating category:', error);
                alert('ì¹´í…Œê³ ë¦¬ ë³€ê²½ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
            }
        }

        // ì¹´í…Œê³ ë¦¬ ì‚­ì œ
        async function deleteCategory(categoryName) {
            if (!confirm(`"${categoryName}" ì¹´í…Œê³ ë¦¬ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nì´ ì¹´í…Œê³ ë¦¬ë¥¼ ì‚¬ìš©í•˜ëŠ” ìŒì•…ë“¤ì˜ ì¹´í…Œê³ ë¦¬ê°€ ì œê±°ë©ë‹ˆë‹¤.`)) {
                return;
            }

            try {
                // í•´ë‹¹ ì¹´í…Œê³ ë¦¬ë¥¼ ì‚¬ìš©í•˜ëŠ” ëª¨ë“  ìŒì•…ì˜ ì¹´í…Œê³ ë¦¬ í•„ë“œ ì œê±°
                const musicCollection = window.firebaseCollection(window.firebaseDb, 'music');
                const musicQuery = window.firebaseQuery(musicCollection, window.firebaseWhere('category', '==', categoryName));
                const musicSnapshot = await window.firebaseGetDocs(musicQuery);

                // ìŒì•… ë¬¸ì„œë¥¼ 500ê°œì”© ë‚˜ëˆ ì„œ batch ì²˜ë¦¬
                const docs = [];
                musicSnapshot.forEach(doc => docs.push(doc));

                for (let i = 0; i < docs.length; i += 500) {
                    const batch = window.firebaseWriteBatch(window.firebaseDb);
                    const chunk = docs.slice(i, i + 500);

                    chunk.forEach(doc => {
                        batch.update(doc.ref, { category: '' });
                    });

                    await batch.commit();
                }

                // ì¹´í…Œê³ ë¦¬ ë¬¸ì„œ ì‚­ì œ
                const categoryRef = window.firebaseDoc(window.firebaseDb, 'categories', categoryName);
                await window.firebaseDeleteDoc(categoryRef);

                alert('ì¹´í…Œê³ ë¦¬ê°€ ì„±ê³µì ìœ¼ë¡œ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
                loadCategories();
                loadMusicList();
                notifyMainPage('categoryUpdated');
            } catch (error) {
                console.error('Error deleting category:', error);
                alert('ì¹´í…Œê³ ë¦¬ ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
            }
        }

        // ========== ì¶”ì²œ ê°¤ëŸ¬ë¦¬ ê´€ë¦¬ í•¨ìˆ˜ë“¤ ==========

        // ìŒì•… ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸°
        async function loadMusicList() {
            try {
                // Firestoreì—ì„œ music ì»¬ë ‰ì…˜ ì¡°íšŒ
                const musicCollection = window.firebaseCollection(window.firebaseDb, 'music');
                const querySnapshot = await window.firebaseGetDocs(musicCollection);

                const musicList = [];
                querySnapshot.forEach(doc => {
                    const data = doc.data();
                    musicList.push({
                        id: doc.id,
                        name: data.name || data.title || 'ì œëª© ì—†ìŒ',
                        category: data.category || '',
                        classification: data.classification || '',
                        recommended: data.recommended || 0,
                        ...data
                    });
                });

                allMusicData = musicList;
                filteredMusicData = allMusicData;
                renderMusicList(filteredMusicData);
                console.log('Music list loaded:', allMusicData.length, 'items');
            } catch (error) {
                console.error('Error loading music list:', error);
                alert('ìŒì•… ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
            }
        }

        // ì¹´í…Œê³ ë¦¬ í•„í„° ë Œë”ë§
        function renderCategoryFilter() {
            const filterCategory = document.getElementById('filterCategory');
            const currentValue = filterCategory.value;

            filterCategory.innerHTML = '<option value="">ì „ì²´</option>';
            allCategories.forEach(cat => {
                const option = document.createElement('option');
                option.value = cat;
                option.textContent = cat;
                if (cat === currentValue) {
                    option.selected = true;
                }
                filterCategory.appendChild(option);
            });
        }

        // í•„í„° ì ìš©
        function applyFilter() {
            const topSectionFilter = document.getElementById('filterTopSection').value;
            const categoryFilter = document.getElementById('filterCategory').value;
            const recommendedFilter = document.getElementById('filterRecommended').value;

            filteredMusicData = allMusicData.filter(music => {
                let match = true;

                // topSection í•„í„°ë§
                if (topSectionFilter) {
                    const categoryDetail = allCategoryDetailsData.find(cat => cat.name === music.category);
                    const musicTopSection = categoryDetail ? categoryDetail.topSection : 'visual-mode';
                    if (musicTopSection !== topSectionFilter) {
                        match = false;
                    }
                }

                if (categoryFilter && music.category !== categoryFilter) {
                    match = false;
                }

                if (recommendedFilter !== '' && music.recommended != recommendedFilter) {
                    match = false;
                }

                return match;
            });

            renderMusicList(filteredMusicData);
        }

        // í•„í„° ì´ˆê¸°í™”
        function resetFilter() {
            document.getElementById('filterTopSection').value = '';
            document.getElementById('filterCategory').value = '';
            document.getElementById('filterRecommended').value = '';
            applyFilter();
        }

        // ìŒì•… ëª©ë¡ ë Œë”ë§
        function renderMusicList(musicList) {
            const musicListContainer = document.getElementById('musicList');
            const emptyMessage = document.getElementById('emptyMusicMessage');

            if (!musicList || musicList.length === 0) {
                musicListContainer.innerHTML = '';
                emptyMessage.classList.remove('hidden');
            } else {
                emptyMessage.classList.add('hidden');

                musicListContainer.innerHTML = musicList.map(music => {
                    const isRecommended = music.recommended == 1;
                    const recommendedBadge = isRecommended ? '<span class="recommended-badge ml-2">â­ ì¶”ì²œ</span>' : '';
                    const colors = getClassificationColor(music.classification);
                    const categoryBadge = music.category ? `<span class="category-badge ml-2" style="background-color: ${colors.hex};">${escapeHtml(music.category)}</span>` : '';

                    const buttonColor = isRecommended ? 'bg-yellow-600 hover:bg-yellow-700' : 'bg-blue-600 hover:bg-blue-700';
                    const buttonText = isRecommended ? 'ì¶”ì²œ í•´ì œ' : 'ì¶”ì²œ ì¶”ê°€';
                    const buttonIcon = isRecommended ? 'â˜†' : 'â­';

                    return `
                        <div class="item flex items-center justify-between p-4 border-2 border-gray-300 rounded-lg bg-white" data-music-id="${music.id}">
                            <div class="flex items-center space-x-3 flex-1">
                                <span class="text-lg font-medium text-gray-800">${escapeHtml(music.name)}</span>
                                ${categoryBadge}
                                <span class="recommended-status" data-music-id="${music.id}">${recommendedBadge}</span>
                            </div>
                            <div class="space-x-2">
                                <button onclick="toggleRecommended(${music.id}, ${isRecommended ? 1 : 0})"
                                        class="recommend-btn px-4 py-2 ${buttonColor} text-white font-semibold rounded transition duration-200"
                                        data-music-id="${music.id}">
                                    ${buttonIcon} ${buttonText}
                                </button>
                            </div>
                        </div>
                    `;
                }).join('');
            }
        }

        // ì¶”ì²œ í† ê¸€
        async function toggleRecommended(musicId, currentState) {
            const newState = currentState ? 0 : 1;
            console.log('toggleRecommended called:', { musicId, currentState, newState });

            // ì¦‰ì‹œ UI ì—…ë°ì´íŠ¸ (ë²„íŠ¼ê³¼ ë°°ì§€)
            const button = document.querySelector(`.recommend-btn[data-music-id="${musicId}"]`);
            const statusSpan = document.querySelector(`.recommended-status[data-music-id="${musicId}"]`);

            if (button) {
                button.disabled = true; // ì¤‘ë³µ í´ë¦­ ë°©ì§€
            }

            try {
                // Firestoreì—ì„œ ìŒì•… ë¬¸ì„œ ì—…ë°ì´íŠ¸
                const musicRef = window.firebaseDoc(window.firebaseDb, 'music', musicId);
                await window.firebaseUpdateDoc(musicRef, {
                    recommended: newState,
                    updatedAt: new Date().toISOString()
                });

                console.log('toggleRecommended success');

                // ë¡œì»¬ ë°ì´í„° ì—…ë°ì´íŠ¸
                const music = allMusicData.find(m => m.id === musicId);
                if (music) {
                    music.recommended = newState;
                    console.log('Updated music data:', music);
                }

                // UI ì¦‰ì‹œ ì—…ë°ì´íŠ¸
                if (button) {
                    const isRecommended = newState == 1;
                    const buttonColor = isRecommended ? 'bg-yellow-600 hover:bg-yellow-700' : 'bg-blue-600 hover:bg-blue-700';
                    const buttonText = isRecommended ? 'ì¶”ì²œ í•´ì œ' : 'ì¶”ì²œ ì¶”ê°€';
                    const buttonIcon = isRecommended ? 'â˜†' : 'â­';

                    button.className = `recommend-btn px-4 py-2 ${buttonColor} text-white font-semibold rounded transition duration-200`;
                    button.innerHTML = `${buttonIcon} ${buttonText}`;
                    button.onclick = function() { toggleRecommended(musicId, isRecommended ? 1 : 0); };
                    button.disabled = false;
                }

                if (statusSpan) {
                    statusSpan.innerHTML = newState == 1 ? '<span class="recommended-badge ml-2">â­ ì¶”ì²œ</span>' : '';
                }

                // ë©”ì¸ í˜ì´ì§€ì— ì•Œë¦¼
                notifyMainPage('recommendedUpdated');

            } catch (error) {
                console.error('Error toggling recommended:', error);
                alert('ì¶”ì²œ ìƒíƒœ ë³€ê²½ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);

                // ì—ëŸ¬ ì‹œ ë²„íŠ¼ ë³µêµ¬
                if (button) {
                    button.disabled = false;
                }
            }
        }

        // ========== ì½˜í…ì¸  ê´€ë¦¬ í•¨ìˆ˜ë“¤ ==========

        let allContentData = [];
        let filteredContentData = [];

        // ì½˜í…ì¸  ëª©ë¡ ë¡œë“œ
        async function loadContentList() {
            try {
                const musicCollection = window.firebaseCollection(window.firebaseDb, 'music');
                const querySnapshot = await window.firebaseGetDocs(musicCollection);

                const contentList = [];
                querySnapshot.forEach(doc => {
                    const data = doc.data();
                    contentList.push({
                        id: doc.id,
                        name: data.name || data.title || 'ì œëª© ì—†ìŒ',
                        category: data.category || '',
                        classification: data.classification || '',
                        recommended: data.recommended || 0,
                        thumbnailUrl: data.imageUrl || data.thumbnailUrl || data.thumbnail || '',
                        musicUrl: data.audioUrl || data.musicUrl || data.music || '',
                        imageCount: data.imageCount || data.images?.length || 0,
                        createdAt: data.createdAt || data.uploadedAt || '',
                        ...data
                    });
                });

                // ìµœì‹ ìˆœ ì •ë ¬
                contentList.sort((a, b) => {
                    const dateA = new Date(a.createdAt || 0);
                    const dateB = new Date(b.createdAt || 0);
                    return dateB - dateA;
                });

                allContentData = contentList;
                filteredContentData = contentList;
                renderContentList(filteredContentData);
                renderContentCategoryFilter();

                console.log('Content list loaded:', allContentData.length, 'items');
            } catch (error) {
                console.error('Error loading content list:', error);
                alert('ì½˜í…ì¸  ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
            }
        }

        // ì½˜í…ì¸  ì¹´í…Œê³ ë¦¬ í•„í„° ë Œë”ë§
        function renderContentCategoryFilter() {
            const filterCategory = document.getElementById('filterContentCategory');
            const currentValue = filterCategory.value;

            filterCategory.innerHTML = '<option value="">ì „ì²´ ì¹´í…Œê³ ë¦¬</option>';
            allCategories.forEach(cat => {
                const option = document.createElement('option');
                option.value = cat;
                option.textContent = cat;
                if (cat === currentValue) {
                    option.selected = true;
                }
                filterCategory.appendChild(option);
            });
        }

        // ì½˜í…ì¸  í•„í„° ì ìš©
        function applyContentFilter() {
            const keyword = document.getElementById('searchContentKeyword').value.trim().toLowerCase();
            const topSection = document.getElementById('filterContentTopSection').value;
            const category = document.getElementById('filterContentCategory').value;

            filteredContentData = allContentData.filter(content => {
                let match = true;

                if (keyword && !content.name.toLowerCase().includes(keyword)) {
                    match = false;
                }

                // topSection í•„í„°ë§
                if (topSection) {
                    const categoryDetail = allCategoryDetailsData.find(cat => cat.name === content.category);
                    const contentTopSection = categoryDetail ? categoryDetail.topSection : 'visual-mode';
                    if (contentTopSection !== topSection) {
                        match = false;
                    }
                }

                if (category && content.category !== category) {
                    match = false;
                }

                return match;
            });

            renderContentList(filteredContentData);
        }

        // ì½˜í…ì¸  í•„í„° ì´ˆê¸°í™”
        function resetContentFilter() {
            document.getElementById('searchContentKeyword').value = '';
            document.getElementById('filterContentTopSection').value = '';
            document.getElementById('filterContentCategory').value = '';
            filteredContentData = allContentData;
            renderContentList(filteredContentData);
        }

        // ì½˜í…ì¸  ëª©ë¡ ë Œë”ë§
        function renderContentList(contentList) {
            const contentListContainer = document.getElementById('contentList');
            const emptyMessage = document.getElementById('emptyContentMessage');

            if (!contentList || contentList.length === 0) {
                contentListContainer.innerHTML = '';
                emptyMessage.classList.remove('hidden');
            } else {
                emptyMessage.classList.add('hidden');

                contentListContainer.innerHTML = contentList.map(content => {
                    const thumbnailUrl = content.thumbnailUrl || 'https://via.placeholder.com/100';
                    const categoryBadge = content.category ? `<span class="px-2 py-1 bg-blue-100 text-blue-800 rounded text-xs">${escapeHtml(content.category)}</span>` : '<span class="text-gray-400 text-xs">ì—†ìŒ</span>';
                    const recommendedBadge = content.recommended ? '<span class="px-2 py-1 bg-yellow-100 text-yellow-800 rounded text-xs">â­ ì¶”ì²œ</span>' : '';
                    const uploadDate = content.createdAt ? new Date(content.createdAt).toLocaleDateString('ko-KR') : '-';

                    return `
                        <tr class="border-b hover:bg-gray-50">
                            <td class="px-4 py-3">
                                <img src="${thumbnailUrl}" alt="ì¸ë„¤ì¼" class="w-16 h-16 object-cover rounded" onerror="this.src='https://via.placeholder.com/100'">
                            </td>
                            <td class="px-4 py-3 text-sm font-medium text-gray-800">${escapeHtml(content.name)}</td>
                            <td class="px-4 py-3 text-sm">${categoryBadge}</td>
                            <td class="px-4 py-3 text-sm">${recommendedBadge}</td>
                            <td class="px-4 py-3 text-sm text-gray-600">${uploadDate}</td>
                            <td class="px-4 py-3 text-center">
                                <button onclick="openEditContentModal('${content.id}')" class="px-3 py-1 bg-blue-600 hover:bg-blue-700 text-white text-sm font-semibold rounded transition duration-200 mr-2">
                                    í¸ì§‘
                                </button>
                                <button onclick="deleteContent('${content.id}', '${escapeHtml(content.name)}')" class="px-3 py-1 bg-red-600 hover:bg-red-700 text-white text-sm font-semibold rounded transition duration-200">
                                    ì‚­ì œ
                                </button>
                            </td>
                        </tr>
                    `;
                }).join('');
            }
        }

        // ì½˜í…ì¸  í¸ì§‘ ëª¨ë‹¬ ì—´ê¸°
        async function openEditContentModal(contentId) {
            try {
                const content = allContentData.find(c => c.id === contentId);
                if (!content) {
                    alert('ì½˜í…ì¸ ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                    return;
                }

                document.getElementById('editContentId').value = contentId;
                document.getElementById('editContentName').value = content.name;
                document.getElementById('editContentThumbnail').src = content.thumbnailUrl || 'https://via.placeholder.com/100';
                document.getElementById('editContentMusicUrl').value = content.musicUrl || '';
                document.getElementById('editContentImageCount').value = content.imageCount || 0;
                document.getElementById('editContentRecommended').checked = content.recommended ? true : false;

                // ì¹´í…Œê³ ë¦¬ ì„ íƒ ì˜µì…˜ ì±„ìš°ê¸°
                const categorySelect = document.getElementById('editContentCategory');
                categorySelect.innerHTML = '<option value="">ì¹´í…Œê³ ë¦¬ ì—†ìŒ</option>';
                allCategories.forEach(cat => {
                    const option = document.createElement('option');
                    option.value = cat;
                    option.textContent = cat;
                    if (cat === content.category) {
                        option.selected = true;
                    }
                    categorySelect.appendChild(option);
                });

                document.getElementById('editContentModal').classList.add('active');
            } catch (error) {
                console.error('Error opening edit modal:', error);
                alert('í¸ì§‘ ëª¨ë‹¬ì„ ì—¬ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
            }
        }

        // ì½˜í…ì¸  í¸ì§‘ ëª¨ë‹¬ ë‹«ê¸°
        function closeEditContentModal() {
            document.getElementById('editContentModal').classList.remove('active');
        }

        // ì½˜í…ì¸  ì €ì¥
        async function saveContentEdit() {
            const contentId = document.getElementById('editContentId').value;
            const name = document.getElementById('editContentName').value.trim();
            const category = document.getElementById('editContentCategory').value;
            const musicUrl = document.getElementById('editContentMusicUrl').value.trim();
            const recommended = document.getElementById('editContentRecommended').checked ? 1 : 0;

            if (!name) {
                alert('ì œëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            try {
                const contentRef = window.firebaseDoc(window.firebaseDb, 'music', contentId);
                await window.firebaseUpdateDoc(contentRef, {
                    name: name,
                    title: name, // í˜¸í™˜ì„±ì„ ìœ„í•´
                    category: category,
                    musicUrl: musicUrl,
                    music: musicUrl, // í˜¸í™˜ì„±ì„ ìœ„í•´
                    recommended: recommended,
                    updatedAt: new Date().toISOString()
                });

                alert('ì½˜í…ì¸ ê°€ ì„±ê³µì ìœ¼ë¡œ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.');
                closeEditContentModal();
                loadContentList();
                loadMusicList(); // ì¶”ì²œ ê°¤ëŸ¬ë¦¬ íƒ­ë„ ìƒˆë¡œê³ ì¹¨
            } catch (error) {
                console.error('Error saving content:', error);
                alert('ì½˜í…ì¸  ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
            }
        }

        // ì½˜í…ì¸  ì‚­ì œ
        async function deleteContent(contentId, contentName) {
            if (!confirm(`"${contentName}" ì½˜í…ì¸ ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìœ¼ë©°, ëª¨ë“  ì´ë¯¸ì§€ì™€ ë°ì´í„°ê°€ ì‚­ì œë©ë‹ˆë‹¤.`)) {
                return;
            }

            try {
                // Firestoreì—ì„œ ë¬¸ì„œ ì‚­ì œ
                const contentRef = window.firebaseDoc(window.firebaseDb, 'music', contentId);
                await window.firebaseDeleteDoc(contentRef);

                // TODO: Storageì—ì„œ ì´ë¯¸ì§€ íŒŒì¼ë“¤ë„ ì‚­ì œí•´ì•¼ í•¨
                // ì´ë¯¸ì§€ ì‚­ì œëŠ” Storage ê²½ë¡œë¥¼ ì•Œì•„ì•¼ í•˜ë¯€ë¡œ ë³„ë„ êµ¬í˜„ í•„ìš”

                alert('ì½˜í…ì¸ ê°€ ì„±ê³µì ìœ¼ë¡œ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
                loadContentList();
                loadMusicList();
            } catch (error) {
                console.error('Error deleting content:', error);
                alert('ì½˜í…ì¸  ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
            }
        }

        // ========== ë°ì´í„° ì •ë¦¬ í•¨ìˆ˜ë“¤ ==========

        // ë°ì´í„°ë² ì´ìŠ¤ ìƒíƒœ í™•ì¸
        async function checkDatabaseStatus() {
            try {
                const statusDiv = document.getElementById('dbStatus');
                const contentDiv = document.getElementById('dbStatusContent');
                statusDiv.classList.remove('hidden');
                contentDiv.textContent = 'ë°ì´í„° ë¡œë”© ì¤‘...';

                // ì¹´í…Œê³ ë¦¬ ìˆ˜ì§‘
                const categoriesSnapshot = await window.firebaseGetDocs(
                    window.firebaseCollection(window.firebaseDb, 'categories')
                );
                const categories = [];
                categoriesSnapshot.forEach(doc => {
                    categories.push({
                        name: doc.id,
                        classification: doc.data().classification || 'ë¯¸ë¶„ë¥˜'
                    });
                });

                // ìŒì•… ìˆ˜ì§‘ ë° ì¹´í…Œê³ ë¦¬ ì‚¬ìš© í˜„í™© íŒŒì•…
                const musicSnapshot = await window.firebaseGetDocs(
                    window.firebaseCollection(window.firebaseDb, 'music')
                );
                const categoryUsage = {};
                let totalMusic = 0;
                let withoutCategory = 0;

                musicSnapshot.forEach(doc => {
                    totalMusic++;
                    const category = doc.data().category;
                    if (!category) {
                        withoutCategory++;
                    } else {
                        categoryUsage[category] = (categoryUsage[category] || 0) + 1;
                    }
                });

                // ê²°ê³¼ ì¶œë ¥
                let output = '=== ë°ì´í„°ë² ì´ìŠ¤ ìƒíƒœ ===\n\n';
                output += `ğŸ“ ë“±ë¡ëœ ì¹´í…Œê³ ë¦¬: ${categories.length}ê°œ\n`;
                categories.forEach(cat => {
                    const count = categoryUsage[cat.name] || 0;
                    output += `   - ${cat.name} (${cat.classification}): ${count}ê°œ ìŒì•…\n`;
                });

                output += `\nğŸµ ì´ ìŒì•…: ${totalMusic}ê°œ\n`;
                output += `   - ì¹´í…Œê³ ë¦¬ ì—†ìŒ: ${withoutCategory}ê°œ\n\n`;

                output += `ğŸ“Š ìŒì•…ì—ì„œ ì‚¬ìš© ì¤‘ì¸ ì¹´í…Œê³ ë¦¬:\n`;
                Object.keys(categoryUsage).sort().forEach(cat => {
                    const inCategories = categories.find(c => c.name === cat);
                    const status = inCategories ? 'âœ“' : 'âš ï¸ categories ì»¬ë ‰ì…˜ì— ì—†ìŒ';
                    output += `   - ${cat}: ${categoryUsage[cat]}ê°œ ${status}\n`;
                });

                const unusedCategories = categories.filter(cat => !categoryUsage[cat.name]);
                if (unusedCategories.length > 0) {
                    output += `\nğŸ—‘ï¸ ì‚¬ìš©ë˜ì§€ ì•ŠëŠ” ì¹´í…Œê³ ë¦¬: ${unusedCategories.length}ê°œ\n`;
                    unusedCategories.forEach(cat => {
                        output += `   - ${cat.name}\n`;
                    });
                }

                contentDiv.textContent = output;
            } catch (error) {
                console.error('Error checking database status:', error);
                alert('ë°ì´í„°ë² ì´ìŠ¤ ìƒíƒœ í™•ì¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
            }
        }

        // ì¹´í…Œê³ ë¦¬ ì¼ê´„ ë³€ê²½
        async function bulkUpdateCategory() {
            const oldCategory = document.getElementById('oldCategoryBulk').value.trim();
            const newCategory = document.getElementById('newCategoryBulk').value.trim();

            if (!oldCategory || !newCategory) {
                alert('ê¸°ì¡´ ì¹´í…Œê³ ë¦¬ì™€ ìƒˆ ì¹´í…Œê³ ë¦¬ë¥¼ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            if (!confirm(`"${oldCategory}" ì¹´í…Œê³ ë¦¬ë¥¼ ì‚¬ìš©í•˜ëŠ” ëª¨ë“  ìŒì•…ì„ "${newCategory}"ë¡œ ë³€ê²½í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                return;
            }

            try {
                // í•´ë‹¹ ì¹´í…Œê³ ë¦¬ë¥¼ ì‚¬ìš©í•˜ëŠ” ìŒì•… ì°¾ê¸°
                const musicCollection = window.firebaseCollection(window.firebaseDb, 'music');
                const musicQuery = window.firebaseQuery(musicCollection, window.firebaseWhere('category', '==', oldCategory));
                const musicSnapshot = await window.firebaseGetDocs(musicQuery);

                if (musicSnapshot.empty) {
                    alert(`"${oldCategory}" ì¹´í…Œê³ ë¦¬ë¥¼ ì‚¬ìš©í•˜ëŠ” ìŒì•…ì´ ì—†ìŠµë‹ˆë‹¤.`);
                    return;
                }

                const count = musicSnapshot.size;
                console.log(`Found ${count} music items with category "${oldCategory}"`);

                // 500ê°œì”© ë‚˜ëˆ ì„œ batch ì²˜ë¦¬
                const docs = [];
                musicSnapshot.forEach(doc => docs.push(doc));

                for (let i = 0; i < docs.length; i += 500) {
                    const batch = window.firebaseWriteBatch(window.firebaseDb);
                    const chunk = docs.slice(i, i + 500);

                    chunk.forEach(doc => {
                        batch.update(doc.ref, { category: newCategory });
                    });

                    await batch.commit();
                    console.log(`Updated batch ${Math.floor(i / 500) + 1}`);
                }

                alert(`${count}ê°œì˜ ìŒì•… ì¹´í…Œê³ ë¦¬ê°€ "${newCategory}"ë¡œ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.`);
                document.getElementById('oldCategoryBulk').value = '';
                document.getElementById('newCategoryBulk').value = '';
                checkDatabaseStatus();
                loadCategories();
                loadMusicList();
            } catch (error) {
                console.error('Error bulk updating category:', error);
                alert('ì¹´í…Œê³ ë¦¬ ì¼ê´„ ë³€ê²½ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
            }
        }

        // ì‚¬ìš©ë˜ì§€ ì•ŠëŠ” ì¹´í…Œê³ ë¦¬ ì •ë¦¬
        async function cleanupUnusedCategories() {
            if (!confirm('ìŒì•…ì—ì„œ ì‚¬ìš©ë˜ì§€ ì•ŠëŠ” ëª¨ë“  ì¹´í…Œê³ ë¦¬ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                return;
            }

            try {
                // ëª¨ë“  ì¹´í…Œê³ ë¦¬ ê°€ì ¸ì˜¤ê¸°
                const categoriesSnapshot = await window.firebaseGetDocs(
                    window.firebaseCollection(window.firebaseDb, 'categories')
                );

                const categories = [];
                categoriesSnapshot.forEach(doc => {
                    categories.push(doc.id);
                });

                // ê° ì¹´í…Œê³ ë¦¬ë³„ë¡œ ì‚¬ìš© ì—¬ë¶€ í™•ì¸
                const unusedCategories = [];
                for (const category of categories) {
                    const musicCollection = window.firebaseCollection(window.firebaseDb, 'music');
                    const musicQuery = window.firebaseQuery(musicCollection, window.firebaseWhere('category', '==', category));
                    const musicSnapshot = await window.firebaseGetDocs(musicQuery);

                    if (musicSnapshot.empty) {
                        unusedCategories.push(category);
                    }
                }

                if (unusedCategories.length === 0) {
                    alert('ì‚¬ìš©ë˜ì§€ ì•ŠëŠ” ì¹´í…Œê³ ë¦¬ê°€ ì—†ìŠµë‹ˆë‹¤.');
                    return;
                }

                // ì‚¬ìš©ë˜ì§€ ì•ŠëŠ” ì¹´í…Œê³ ë¦¬ ì‚­ì œ
                for (const category of unusedCategories) {
                    const categoryRef = window.firebaseDoc(window.firebaseDb, 'categories', category);
                    await window.firebaseDeleteDoc(categoryRef);
                    console.log(`Deleted unused category: ${category}`);
                }

                alert(`${unusedCategories.length}ê°œì˜ ì‚¬ìš©ë˜ì§€ ì•ŠëŠ” ì¹´í…Œê³ ë¦¬ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤:\n${unusedCategories.join(', ')}`);
                checkDatabaseStatus();
                loadCategories();
            } catch (error) {
                console.error('Error cleaning up unused categories:', error);
                alert('ì¹´í…Œê³ ë¦¬ ì •ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
            }
        }

        // ========== ê³µí†µ í•¨ìˆ˜ë“¤ ==========

        // HTML ì´ìŠ¤ì¼€ì´í”„ í•¨ìˆ˜
        function escapeHtml(text) {
            if (!text) return '';
            const map = {
                '&': '&amp;',
                '<': '&lt;',
                '>': '&gt;',
                '"': '&quot;',
                "'": '&#039;'
            };
            return String(text).replace(/[&<>"']/g, m => map[m]);
        }

        // ë©”ì¸ í˜ì´ì§€ì— ì—…ë°ì´íŠ¸ ì•Œë¦¼
        function notifyMainPage(eventType) {
            localStorage.setItem('adminUpdateEvent', JSON.stringify({
                type: eventType,
                timestamp: Date.now()
            }));
        }

        // ========== íšŒì› ê´€ë¦¬ í•¨ìˆ˜ë“¤ ==========

        // ì „ì²´ íšŒì› ë¡œë“œ
        async function loadAllUsers() {
            try {
                const usersCollection = window.firebaseCollection(window.firebaseDb, 'users');
                const querySnapshot = await window.firebaseGetDocs(usersCollection);

                const users = [];
                querySnapshot.forEach(doc => {
                    users.push({
                        uid: doc.id,
                        ...doc.data()
                    });
                });

                // ê°€ì…ì¼ ê¸°ì¤€ ìµœì‹ ìˆœ ì •ë ¬
                users.sort((a, b) => {
                    const dateA = new Date(a.createdAt || 0);
                    const dateB = new Date(b.createdAt || 0);
                    return dateB - dateA;
                });

                renderUsers(users);
            } catch (error) {
                console.error('íšŒì› ëª©ë¡ ë¡œë“œ ì˜¤ë¥˜:', error);
                alert('íšŒì› ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }

        // íšŒì› ê²€ìƒ‰
        async function searchUsers() {
            const searchEmail = document.getElementById('searchUserEmail').value.trim().toLowerCase();

            if (!searchEmail) {
                alert('ê²€ìƒ‰í•  ì´ë©”ì¼ì„ ì…ë ¥í•˜ì„¸ìš”.');
                return;
            }

            try {
                const usersCollection = window.firebaseCollection(window.firebaseDb, 'users');
                const querySnapshot = await window.firebaseGetDocs(usersCollection);

                const users = [];
                querySnapshot.forEach(doc => {
                    const userData = doc.data();
                    if (userData.email && userData.email.toLowerCase().includes(searchEmail)) {
                        users.push({
                            uid: doc.id,
                            ...userData
                        });
                    }
                });

                renderUsers(users);

                if (users.length === 0) {
                    alert('ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.');
                }
            } catch (error) {
                console.error('íšŒì› ê²€ìƒ‰ ì˜¤ë¥˜:', error);
                alert('íšŒì› ê²€ìƒ‰ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }

        // íšŒì› ëª©ë¡ ë Œë”ë§
        function renderUsers(users) {
            const userList = document.getElementById('userList');
            const emptyMessage = document.getElementById('emptyUserMessage');

            if (!users || users.length === 0) {
                userList.innerHTML = '';
                emptyMessage.classList.remove('hidden');
                return;
            }

            emptyMessage.classList.add('hidden');

            userList.innerHTML = users.map(user => {
                const roleText = user.role === 'admin' ? 'ê´€ë¦¬ì' : user.role === 'creator' ? 'í¬ë¦¬ì—ì´í„°' : 'ì¼ë°˜ íšŒì›';
                const roleColor = user.role === 'admin' ? 'text-red-600 font-bold' : user.role === 'creator' ? 'text-blue-600' : 'text-gray-600';
                const createdAt = user.createdAt ? new Date(user.createdAt).toLocaleDateString('ko-KR') : '-';

                return `
                    <tr class="border-b hover:bg-gray-50">
                        <td class="px-4 py-3 text-sm">${escapeHtml(user.email)}</td>
                        <td class="px-4 py-3 text-sm ${roleColor}">${roleText}</td>
                        <td class="px-4 py-3 text-sm">${user.dailyPoints || 0}P</td>
                        <td class="px-4 py-3 text-sm">${user.walletBalance || 0}P</td>
                        <td class="px-4 py-3 text-sm">${createdAt}</td>
                        <td class="px-4 py-3 text-center space-x-2">
                            <button onclick="deleteUser('${user.uid}', '${escapeHtml(user.email)}')"
                                    class="px-3 py-1 bg-red-600 hover:bg-red-700 text-white text-sm font-semibold rounded transition duration-200">
                                íƒˆí‡´
                            </button>
                        </td>
                    </tr>
                `;
            }).join('');
        }


        // íšŒì› íƒˆí‡´
        async function deleteUser(uid, email) {
            if (!confirm(`ì •ë§ë¡œ ${email} íšŒì›ì„ íƒˆí‡´ì‹œí‚¤ê² ìŠµë‹ˆê¹Œ?\n\nì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìœ¼ë©°, ë‹¤ìŒ ë°ì´í„°ê°€ ì‚­ì œë©ë‹ˆë‹¤:\n- íšŒì› ì •ë³´\n- ì¢‹ì•„ìš” ë‚´ì—­\n- ì €ì¥ ëª©ë¡\n- í¬ì¸íŠ¸ ê±°ë˜ ë‚´ì—­\n\nâš ï¸ ì£¼ì˜: Firebase Authentication ê³„ì •ì€ ìˆ˜ë™ìœ¼ë¡œ ì‚­ì œí•´ì•¼ í•©ë‹ˆë‹¤.`)) {
                return;
            }

            try {
                // Firestoreì—ì„œ íšŒì› ì •ë³´ ì‚­ì œ
                const userDocRef = window.firebaseDoc(window.firebaseDb, 'users', uid);
                await window.firebaseDeleteDoc(userDocRef);

                // ì¢‹ì•„ìš” ë‚´ì—­ ì‚­ì œ
                const likesCollection = window.firebaseCollection(window.firebaseDb, 'likes');
                const likesQuery = window.firebaseQuery(likesCollection, window.firebaseWhere('userId', '==', uid));
                const likesSnapshot = await window.firebaseGetDocs(likesQuery);
                const likeDeletePromises = [];
                likesSnapshot.forEach(doc => {
                    likeDeletePromises.push(window.firebaseDeleteDoc(doc.ref));
                });
                await Promise.all(likeDeletePromises);

                // ì €ì¥ ëª©ë¡ ì‚­ì œ
                const savedCollection = window.firebaseCollection(window.firebaseDb, 'savedMusic');
                const savedQuery = window.firebaseQuery(savedCollection, window.firebaseWhere('userId', '==', uid));
                const savedSnapshot = await window.firebaseGetDocs(savedQuery);
                const savedDeletePromises = [];
                savedSnapshot.forEach(doc => {
                    savedDeletePromises.push(window.firebaseDeleteDoc(doc.ref));
                });
                await Promise.all(savedDeletePromises);

                // í¬ì¸íŠ¸ ê±°ë˜ ë‚´ì—­ ì‚­ì œ
                const transactionsCollection = window.firebaseCollection(window.firebaseDb, 'pointTransactions');
                const transactionsQuery = window.firebaseQuery(transactionsCollection, window.firebaseWhere('userId', '==', uid));
                const transactionsSnapshot = await window.firebaseGetDocs(transactionsQuery);
                const transactionDeletePromises = [];
                transactionsSnapshot.forEach(doc => {
                    transactionDeletePromises.push(window.firebaseDeleteDoc(doc.ref));
                });
                await Promise.all(transactionDeletePromises);

                alert(`${email} íšŒì›ì´ íƒˆí‡´ ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤.\n\nFirebase Authenticationì—ì„œ í•´ë‹¹ ê³„ì •ì„ ìˆ˜ë™ìœ¼ë¡œ ì‚­ì œí•´ì£¼ì„¸ìš”.`);

                // íšŒì› ëª©ë¡ ìƒˆë¡œê³ ì¹¨
                loadAllUsers();
            } catch (error) {
                console.error('íšŒì› íƒˆí‡´ ì²˜ë¦¬ ì˜¤ë¥˜:', error);
                alert('íšŒì› íƒˆí‡´ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
            }
        }

        // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
        document.getElementById('editModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeEditModal();
            }
        });

        document.getElementById('editContentModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeEditContentModal();
            }
        });


        // Enter í‚¤ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        document.addEventListener('DOMContentLoaded', function() {
            // íšŒì› ê²€ìƒ‰ Enter í‚¤
            const searchInput = document.getElementById('searchUserEmail');
            if (searchInput) {
                searchInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        searchUsers();
                    }
                });
            }

            // ì¹´í…Œê³ ë¦¬ ì¶”ê°€ Enter í‚¤
            const categoryNameInput = document.getElementById('newCategoryNameInput');
            if (categoryNameInput) {
                categoryNameInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        addNewCategory();
                    }
                });
            }

            // ì½˜í…ì¸  ê²€ìƒ‰ Enter í‚¤
            const contentSearchInput = document.getElementById('searchContentKeyword');
            if (contentSearchInput) {
                contentSearchInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        applyContentFilter();
                    }
                });
            }
        });

        // ========== ë§ˆì´ê·¸ë ˆì´ì…˜ í•¨ìˆ˜ë“¤ ==========

        function migrationLog(message, type = 'info') {
            const logDiv = document.getElementById('migrationLog');
            const timestamp = new Date().toLocaleTimeString();
            let color = '#374151'; // gray-700

            if (type === 'success') color = '#10b981'; // green-500
            if (type === 'error') color = '#ef4444'; // red-500
            if (type === 'warning') color = '#f59e0b'; // amber-500

            logDiv.innerHTML += `<span style="color: ${color}">[${timestamp}] ${message}</span>\n`;
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(message);
        }

        // ë§ˆì´ê·¸ë ˆì´ì…˜ ìƒíƒœ í™•ì¸
        async function checkMigrationStatus() {
            const btn = document.getElementById('checkMigrationBtn');
            btn.disabled = true;
            document.getElementById('migrationLog').innerHTML = '';

            try {
                migrationLog('=== ì¹´í…Œê³ ë¦¬ ìƒíƒœ í™•ì¸ ì‹œì‘ ===', 'info');

                const categoriesRef = window.firebaseCollection(window.firebaseDb, 'categories');
                const querySnapshot = await window.firebaseGetDocs(categoriesRef);

                let totalCount = 0;
                let withTopSection = 0;
                let withoutTopSection = 0;
                const categoriesWithoutTopSection = [];

                querySnapshot.forEach((doc) => {
                    totalCount++;
                    const data = doc.data();

                    if (data.topSection) {
                        withTopSection++;
                        migrationLog(`âœ“ ${doc.id}: topSection="${data.topSection}"`, 'success');
                    } else {
                        withoutTopSection++;
                        categoriesWithoutTopSection.push(doc.id);
                        migrationLog(`âœ— ${doc.id}: topSection ì—†ìŒ`, 'error');
                    }
                });

                migrationLog('\n=== í†µê³„ ===', 'info');
                migrationLog(`ì „ì²´ ì¹´í…Œê³ ë¦¬: ${totalCount}ê°œ`, 'info');
                migrationLog(`topSection ìˆìŒ: ${withTopSection}ê°œ`, 'success');
                migrationLog(`topSection ì—†ìŒ: ${withoutTopSection}ê°œ`, 'error');

                if (withoutTopSection > 0) {
                    migrationLog('\në§ˆì´ê·¸ë ˆì´ì…˜ì´ í•„ìš”í•œ ì¹´í…Œê³ ë¦¬:', 'error');
                    categoriesWithoutTopSection.forEach(cat => migrationLog(`  - ${cat}`, 'error'));
                    migrationLog('\n"2ï¸âƒ£ ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤í–‰" ë²„íŠ¼ì„ ëˆŒëŸ¬ ì—…ë°ì´íŠ¸í•˜ì„¸ìš”.', 'info');
                    document.getElementById('migrationBtn').disabled = false;
                } else {
                    migrationLog('\nëª¨ë“  ì¹´í…Œê³ ë¦¬ê°€ ì •ìƒì…ë‹ˆë‹¤! ë§ˆì´ê·¸ë ˆì´ì…˜ì´ í•„ìš”í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.', 'success');
                    document.getElementById('migrationBtn').disabled = true;
                }

            } catch (error) {
                migrationLog('ìƒíƒœ í™•ì¸ ì¤‘ ì˜¤ë¥˜: ' + error.message, 'error');
            } finally {
                btn.disabled = false;
            }
        }

        // ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤í–‰
        async function runCategoryMigration() {
            if (!confirm('ì •ë§ë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜ì„ ì‹¤í–‰í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\ntopSectionì´ ì—†ëŠ” ëª¨ë“  ì¹´í…Œê³ ë¦¬ì— topSection="visual-mode"ê°€ ì¶”ê°€ë©ë‹ˆë‹¤.')) {
                return;
            }

            const btn = document.getElementById('migrationBtn');
            const checkBtn = document.getElementById('checkMigrationBtn');
            btn.disabled = true;
            checkBtn.disabled = true;

            try {
                migrationLog('\n=== ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹œì‘ ===', 'info');

                const categoriesRef = window.firebaseCollection(window.firebaseDb, 'categories');
                const querySnapshot = await window.firebaseGetDocs(categoriesRef);

                let updatedCount = 0;
                let skippedCount = 0;
                let errorCount = 0;

                for (const docSnapshot of querySnapshot.docs) {
                    const data = docSnapshot.data();

                    if (!data.topSection) {
                        try {
                            const docRef = window.firebaseDoc(window.firebaseDb, 'categories', docSnapshot.id);
                            await window.firebaseUpdateDoc(docRef, {
                                topSection: 'visual-mode'
                            });
                            updatedCount++;
                            migrationLog(`âœ“ ${docSnapshot.id}: topSection="visual-mode" ì¶”ê°€ë¨`, 'success');
                        } catch (error) {
                            errorCount++;
                            migrationLog(`âœ— ${docSnapshot.id}: ì—…ë°ì´íŠ¸ ì‹¤íŒ¨ - ${error.message}`, 'error');
                        }
                    } else {
                        skippedCount++;
                        migrationLog(`âŠ˜ ${docSnapshot.id}: ì´ë¯¸ topSection="${data.topSection}" ìˆìŒ (ê±´ë„ˆëœ€)`, 'info');
                    }
                }

                migrationLog('\n=== ë§ˆì´ê·¸ë ˆì´ì…˜ ì™„ë£Œ ===', 'success');
                migrationLog(`ì—…ë°ì´íŠ¸ë¨: ${updatedCount}ê°œ`, 'success');
                migrationLog(`ê±´ë„ˆëœ€: ${skippedCount}ê°œ`, 'info');
                if (errorCount > 0) {
                    migrationLog(`ì‹¤íŒ¨: ${errorCount}ê°œ`, 'error');
                }

                migrationLog('\në§ˆì´ê·¸ë ˆì´ì…˜ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
                migrationLog('ì¹´í…Œê³ ë¦¬ ê´€ë¦¬ íƒ­ì—ì„œ ê° ì¹´í…Œê³ ë¦¬ì˜ topSectionì„ í™•ì¸í•˜ê³  í•„ìš”ì‹œ ìˆ˜ì •í•˜ì„¸ìš”.', 'warning');

                // ì¹´í…Œê³ ë¦¬ ëª©ë¡ ìƒˆë¡œê³ ì¹¨
                await loadCategories();

            } catch (error) {
                migrationLog('ë§ˆì´ê·¸ë ˆì´ì…˜ ì¤‘ ì˜¤ë¥˜: ' + error.message, 'error');
            } finally {
                btn.disabled = false;
                checkBtn.disabled = false;
            }
        }

        // ========================================
        // íˆì–´ë¡œ ìŠ¬ë¼ì´ë“œ ê´€ë¦¬ í•¨ìˆ˜ë“¤
        // ========================================

        // íˆì–´ë¡œ ìŠ¬ë¼ì´ë“œ ëª©ë¡ ë¡œë“œ
        async function loadHeroSlides() {
            try {
                const slidesQuery = window.firebaseQuery(
                    window.firebaseCollection(window.firebaseDb, 'heroSlides'),
                    window.firebaseOrderBy('order', 'asc')
                );
                const querySnapshot = await window.firebaseGetDocs(slidesQuery);

                const slidesList = document.getElementById('heroSlidesList');
                const emptyMessage = document.getElementById('emptyHeroSlidesMessage');

                slidesList.innerHTML = '';

                if (querySnapshot.empty) {
                    emptyMessage.classList.remove('hidden');
                    return;
                }

                emptyMessage.classList.add('hidden');

                querySnapshot.forEach((doc) => {
                    const slide = { id: doc.id, ...doc.data() };
                    slidesList.innerHTML += renderHeroSlideItem(slide);
                });
            } catch (error) {
                console.error('ìŠ¬ë¼ì´ë“œ ë¡œë“œ ì˜¤ë¥˜:', error);
                alert('ìŠ¬ë¼ì´ë“œë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
            }
        }

        // ìŠ¬ë¼ì´ë“œ ì•„ì´í…œ ë Œë”ë§
        function renderHeroSlideItem(slide) {
            const activeStatus = slide.active ?
                '<span class="px-3 py-1 bg-green-100 text-green-800 rounded-full text-sm font-semibold">í™œì„±í™”</span>' :
                '<span class="px-3 py-1 bg-gray-100 text-gray-800 rounded-full text-sm font-semibold">ë¹„í™œì„±í™”</span>';

            return `
                <div class="border border-gray-300 rounded-lg p-4 hover:shadow-md transition">
                    <div class="flex gap-4">
                        <div class="w-48 h-32 flex-shrink-0">
                            <img src="${slide.imageUrl}" alt="${slide.title}" class="w-full h-full object-cover rounded-lg">
                        </div>
                        <div class="flex-1">
                            <div class="flex justify-between items-start mb-2">
                                <div>
                                    <h3 class="text-lg font-bold text-gray-800">${slide.title}</h3>
                                    <p class="text-gray-600">${slide.subtitle || ''}</p>
                                </div>
                                <div class="flex items-center gap-2">
                                    ${activeStatus}
                                    <span class="px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm font-semibold">ìˆœì„œ: ${slide.order}</span>
                                </div>
                            </div>
                            ${slide.link ? `<p class="text-sm text-gray-500 mb-2">ë§í¬: <a href="${slide.link}" target="_blank" class="text-blue-600 hover:underline">${slide.link}</a></p>` : ''}
                            <div class="flex gap-2 mt-3">
                                <button onclick="toggleSlideActive('${slide.id}', ${slide.active})"
                                        class="px-4 py-2 ${slide.active ? 'bg-gray-600 hover:bg-gray-700' : 'bg-green-600 hover:bg-green-700'} text-white font-semibold rounded-lg transition duration-200">
                                    ${slide.active ? 'ë¹„í™œì„±í™”' : 'í™œì„±í™”'}
                                </button>
                                <button onclick="deleteHeroSlide('${slide.id}', '${slide.imageUrl}')"
                                        class="px-4 py-2 bg-red-600 hover:bg-red-700 text-white font-semibold rounded-lg transition duration-200">
                                    ì‚­ì œ
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // ìƒˆ ìŠ¬ë¼ì´ë“œ ì¶”ê°€
        async function addNewSlide() {
            try {
                const title = document.getElementById('newSlideTitle').value.trim();
                const subtitle = document.getElementById('newSlideSubtitle').value.trim();
                const imageFile = document.getElementById('newSlideImage').files[0];
                const link = document.getElementById('newSlideLink').value.trim();
                const order = parseInt(document.getElementById('newSlideOrder').value) || 0;
                const active = document.getElementById('newSlideActive').checked;

                // ìœ íš¨ì„± ê²€ì‚¬
                if (!title) {
                    alert('ì œëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                    return;
                }

                if (!imageFile) {
                    alert('ì´ë¯¸ì§€ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
                    return;
                }

                // ì´ë¯¸ì§€ ì—…ë¡œë“œ
                const imageRef = window.firebaseStorageRef(window.firebaseStorage, `heroSlides/${Date.now()}_${imageFile.name}`);
                await window.firebaseUploadBytes(imageRef, imageFile);
                const imageUrl = await window.firebaseGetDownloadURL(imageRef);

                // Firestoreì— ì €ì¥
                const slideData = {
                    title,
                    subtitle,
                    imageUrl,
                    link: link || null,
                    order,
                    active,
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                };

                await window.firebaseAddDoc(
                    window.firebaseCollection(window.firebaseDb, 'heroSlides'),
                    slideData
                );

                alert('ìŠ¬ë¼ì´ë“œê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!');

                // ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
                document.getElementById('newSlideTitle').value = '';
                document.getElementById('newSlideSubtitle').value = '';
                document.getElementById('newSlideImage').value = '';
                document.getElementById('newSlideLink').value = '';
                document.getElementById('newSlideOrder').value = '0';
                document.getElementById('newSlideActive').checked = true;

                // ëª©ë¡ ìƒˆë¡œê³ ì¹¨
                await loadHeroSlides();
            } catch (error) {
                console.error('ìŠ¬ë¼ì´ë“œ ì¶”ê°€ ì˜¤ë¥˜:', error);
                alert('ìŠ¬ë¼ì´ë“œ ì¶”ê°€ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
            }
        }

        // ìŠ¬ë¼ì´ë“œ í™œì„±í™”/ë¹„í™œì„±í™” í† ê¸€
        async function toggleSlideActive(slideId, currentActive) {
            try {
                const docRef = window.firebaseDoc(window.firebaseDb, 'heroSlides', slideId);
                await window.firebaseUpdateDoc(docRef, {
                    active: !currentActive,
                    updatedAt: new Date().toISOString()
                });

                alert('ìŠ¬ë¼ì´ë“œ ìƒíƒœê°€ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤!');
                await loadHeroSlides();
            } catch (error) {
                console.error('ìŠ¬ë¼ì´ë“œ ìƒíƒœ ë³€ê²½ ì˜¤ë¥˜:', error);
                alert('ìŠ¬ë¼ì´ë“œ ìƒíƒœ ë³€ê²½ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
            }
        }

        // ìŠ¬ë¼ì´ë“œ ì‚­ì œ
        async function deleteHeroSlide(slideId, imageUrl) {
            if (!confirm('ì •ë§ë¡œ ì´ ìŠ¬ë¼ì´ë“œë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                return;
            }

            try {
                // Storageì—ì„œ ì´ë¯¸ì§€ ì‚­ì œ
                if (imageUrl) {
                    try {
                        const imageRef = window.firebaseStorageRef(window.firebaseStorage, imageUrl);
                        await window.firebaseDeleteObject(imageRef);
                    } catch (error) {
                        console.log('ì´ë¯¸ì§€ ì‚­ì œ ì‹¤íŒ¨ (ì´ë¯¸ ì‚­ì œë˜ì—ˆì„ ìˆ˜ ìˆìŒ):', error);
                    }
                }

                // Firestoreì—ì„œ ë¬¸ì„œ ì‚­ì œ
                await window.firebaseDeleteDoc(
                    window.firebaseDoc(window.firebaseDb, 'heroSlides', slideId)
                );

                alert('ìŠ¬ë¼ì´ë“œê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤!');
                await loadHeroSlides();
            } catch (error) {
                console.error('ìŠ¬ë¼ì´ë“œ ì‚­ì œ ì˜¤ë¥˜:', error);
                alert('ìŠ¬ë¼ì´ë“œ ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
            }
        }
    </script>
</body>
</html>
